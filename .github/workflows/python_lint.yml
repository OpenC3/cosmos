# Copyright 2026 OpenC3, Inc.
# All Rights Reserved.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See LICENSE.md for more details.

# This file may also be used under the terms of a commercial license
# if purchased from OpenC3, Inc.

name: Python Lint

on:
  pull_request:
    branches-ignore:
      - "dependabot/**"
    types:
      - opened
      - reopened
      - synchronize
    paths:
      - "openc3/python/**/*.py"
      - "openc3-cosmos-script-runner-api/scripts/**/*.py"
      - "openc3-cosmos-script-runner-api/test/**/*.py"
      - "openc3/python/pyproject.toml"
      - "openc3/python/uv.lock"

permissions:
  contents: read

jobs:
  ruff:
    if: ${{ github.actor != 'dependabot[bot]' }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6
      - name: Install uv
        uses: astral-sh/setup-uv@eac588ad8def6316056a12d4907a9d4d84ff7a3b # v7
        with:
          enable-cache: true
      - name: Set up Python
        run: uv python install
        working-directory: openc3/python
      - name: Install dependencies
        run: uv sync --frozen
        working-directory: openc3/python
      - name: Run ruff check on openc3/python
        run: uv run --frozen ruff check --output-format=github openc3
        working-directory: openc3/python
      - name: Run ruff format check on openc3/python
        run: uv run --frozen ruff format --check openc3
        working-directory: openc3/python
      - name: Run ruff check on script-runner-api scripts
        run: uv run --frozen ruff check --output-format=github ../../openc3-cosmos-script-runner-api/scripts
        working-directory: openc3/python
      - name: Run ruff format check on script-runner-api scripts
        run: uv run --frozen ruff format --check ../../openc3-cosmos-script-runner-api/scripts
        working-directory: openc3/python
