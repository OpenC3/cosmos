<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-development/streaming-api" data-has-hydrated=false><head><meta charset=UTF-8><meta name=generator content="Docusaurus v3.9.2"><title data-rh=true>Streaming API | OpenC3 Docs</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"/><meta data-rh=true name=twitter:card content=summary_large_image /><meta data-rh=true property=og:url content=https://docs.openc3.com/docs/development/streaming-api /><meta data-rh=true property=og:locale content=en /><meta data-rh=true name=docusaurus_locale content=en /><meta data-rh=true name=docsearch:language content=en /><meta data-rh=true name=docusaurus_version content=current /><meta data-rh=true name=docusaurus_tag content=docs-default-current /><meta data-rh=true name=docsearch:version content=current /><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current /><meta data-rh=true property=og:title content="Streaming API | OpenC3 Docs"/><meta data-rh=true name=description content="Using the websocket streaming API to retrieve data"/><meta data-rh=true property=og:description content="Using the websocket streaming API to retrieve data"/><link data-rh=true rel=icon href=/img/favicon.png /><link data-rh=true rel=canonical href=https://docs.openc3.com/docs/development/streaming-api /><link data-rh=true rel=alternate href=https://docs.openc3.com/docs/development/streaming-api hreflang=en /><link data-rh=true rel=alternate href=https://docs.openc3.com/docs/development/streaming-api hreflang=x-default /><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","item":"https://docs.openc3.com/docs/development","name":"Development","position":1},{"@type":"ListItem","item":"https://docs.openc3.com/docs/development/streaming-api","name":"Streaming API","position":2}]}</script><link rel=stylesheet href=/assets/css/styles.050d3b6a.css /><script src=/assets/js/runtime~main.ea749110.js defer></script><script src=/assets/js/main.d25e6cf9.js defer></script></head><body class=navigation-with-keyboard><svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"dark"),document.documentElement.setAttribute("data-theme-choice",t||"dark")}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/logo.svg /><div role=region aria-label="Skip to main content"><a class=skipToContent_qOfk href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="theme-layout-navbar navbar navbar--fixed-top"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/logo.svg alt="OpenC3 Logo" class="themedComponent_ZvL8 themedComponent--light_RYIK"/><img src=/img/logo.svg alt="OpenC3 Logo" class="themedComponent_ZvL8 themedComponent--dark_Uy6A"/></div><b class="navbar__title text--truncate">OpenC3 Docs</b></a><a href=https://openc3.com target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Home</a><a href=https://openc3.com/enterprise/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Enterprise</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs>Documentation</a><a href=https://openc3.com/news/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">News</a><a href=https://openc3.com/contact/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Contact</a><a href=https://openc3.com/about/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">About</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://github.com/OpenC3/cosmos target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="toggle_TrV1 colorModeToggle_aQ9L"><button class="clean-btn toggleButton_HWKQ toggleButtonDisabled_NaUv" type=button disabled title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_JJdA lightToggleIcon_QAoA"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_JJdA darkToggleIcon_KnJu"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_JJdA systemToggleIcon_jOK6"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_gn0B><div class=navbar__search><span aria-label="expand searchbar" role=button class=search-icon tabindex=0></span><input id=search_input_react type=search placeholder=Loading... aria-label=Search class="navbar__search-input search-bar" disabled/></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_MNjx"><div class=docsWrapper_U6pW><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Zx9e" type=button></button><div class=docRoot_WlTO><aside class="theme-doc-sidebar-container docSidebarContainer_JrhQ"><div class=sidebarViewport_aHzs><div class=sidebar_Zs6D><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Fdb4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs><span title=Introduction class=linkLabel_W2vP>Introduction</span></a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist" href=/docs/getting-started><span title="Getting Started" class=categoryLinkLabel_kxse>Getting Started</span></a><button aria-label="Expand sidebar category 'Getting Started'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist" href=/docs/configuration><span title=Configuration class=categoryLinkLabel_kxse>Configuration</span></a><button aria-label="Expand sidebar category 'Configuration'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist" href=/docs/tools><span title=Tools class=categoryLinkLabel_kxse>Tools</span></a><button aria-label="Expand sidebar category 'Tools'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist" href=/docs/guides><span title=Guides class=categoryLinkLabel_kxse>Guides</span></a><button aria-label="Expand sidebar category 'Guides'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist menu__link--active" href=/docs/development><span title=Development class=categoryLinkLabel_kxse>Development</span></a><button aria-label="Collapse sidebar category 'Development'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/developing><span title="Developing COSMOS" class=linkLabel_W2vP>Developing COSMOS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/json-api><span title="JSON API" class=linkLabel_W2vP>JSON API</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/log-structure><span title="Log Structure" class=linkLabel_W2vP>Log Structure</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/microservices><span title=Microservices class=linkLabel_W2vP>Microservices</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/roadmap><span title=Roadmap class=linkLabel_W2vP>Roadmap</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs/development/streaming-api><span title="Streaming API" class=linkLabel_W2vP>Streaming API</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/testing><span title="Testing COSMOS" class=linkLabel_W2vP>Testing COSMOS</span></a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs/development/web-socket-api><span title="Web Socket API" class=linkLabel_W2vP>Web Socket API</span></a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="categoryLink_xRfu menu__link menu__link--sublist" href=/docs/meta><span title=Meta class=categoryLinkLabel_kxse>Meta</span></a><button aria-label="Expand sidebar category 'Meta'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/privacy><span title="OpenC3, Inc. Privacy Policy" class=linkLabel_W2vP>OpenC3, Inc. Privacy Policy</span></a></ul></nav></div></div></aside><main class=docMainContainer_HlEo><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_DhTU"><div class=docItemContainer_nzR9><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_XktS" aria-label=Breadcrumbs><ul class=breadcrumbs><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YXXP><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li class=breadcrumbs__item><a class=breadcrumbs__link href=/docs/development><span>Development</span></a><li class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link>Streaming API</span></ul></nav><div class="tocCollapsible_KSbj theme-doc-toc-mobile tocMobile_HRWM"><button type=button class="clean-btn tocCollapsibleButton_ztnW">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Streaming API</h1></header><div class="theme-admonition theme-admonition-note admonition_NmnO alert alert--secondary"><div class=admonitionHeading_UyoZ><span class=admonitionIcon_zVPi><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"/></svg></span>This documentation is for COSMOS Developers</div><div class=admonitionContent_8P1D><p>This information is just generally used behind the scenes in COSMOS tools</div></div>
<p>The COSMOS Streaming Api is the primary interface to receive a stream of the telemetry packets and/or command packets that have passed through the COSMOS system, both logged and continuously in realtime. Either raw binary packets or decommutated JSON packets can be requested.</p>
<p>This API is implemented over Websockets using the Rails ActionCable framework. Actioncable client libraries are known to exist for at least Javascript, Ruby, and Python. Other languages may exist or could be created. Websockets allow for easy interaction with the new COSMOS Javascript based frontend.</p>
<p>The following interactions are all shown in Javascript, but would be very similar in any language.
Connecting to this API begins by initiating an ActionCable connection.</p>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">cable = ActionCable.createConsumer('/openc3-api/cable')</span><br/></span></code></pre></div></div>
<p>This call opens the HTTP connection to the given URL and upgrades it to a websocket connection. This connection can then be shared with multiple “subscriptions”.</p>
<p>A subscription describes a set of data that you want the API to stream to you. Creating a subscription looks like this:</p>
<div class="language-javascript codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-javascript codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">subscription </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> cable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">subscriptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">channel</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"StreamingChannel"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">scope</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"DEFAULT"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">token</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> token</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">received</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Handle received data</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">connected</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// First chance to add what you want to stream here</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">disconnected</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Handle the subscription being disconnected</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">rejected</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// Handle the subscription being rejected</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br/></span></code></pre></div></div>
<p>Subscribing to the StreamingApi requires passing a channel name set to “StreamingChannel”, a scope which is typically “DEFAULT”, and an access token (a password in COSMOS Core). In Javascript you also pass a set of callback functions that run at various lifecycle points in the subscription. The most important of these are <code>connected</code> and <code>received</code>.</p>
<p><code>connected</code> runs when the subscription is accepted by the StreamApi. This callback is the first opportunity to request specific data that you would like streamed. Data can also be added or removed at any time while the subscription is open.</p>
<p>Data can be added to the stream by requesting individual items from a packet or by requesting the entire packet.</p>
<p>Adding items to stream is done as follows:</p>
<div class="language-javascript codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-javascript codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> items </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__TLM__INST__ADCS__Q1__RAW"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"0"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__CMD__INST__COLLECT__DURATION__FORMATTED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"1"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token maybe-class-name">OpenC3Auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">updateToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">OpenC3Auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">defaultMinValidity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">subscription</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">perform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">"add"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">scope</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">openc3Scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">token</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">localStorage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">openc3Token</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">items</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> items</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">start_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">startDateTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">end_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">endDateTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br/></span></code></pre></div></div>
<p>The values in the item name are separated by double underscores, e.g. <code>&lt;MODE>__&lt;CMD or TLM>__&lt;TARGET NAME>__&lt;PACKET NAME>__&lt;ITEM NAME>__&lt;VALUE TYPE>__&lt;REDUCED TYPE></code>. Mode is either RAW, DECOM, REDUCED_MINUTE, REDUCED_HOUR, or REDUCED_DAY. The next parameter is CMD or TLM followed by the target, packet and item names. The Value Type is one of RAW, CONVERTED or FORMATTED. The last parameter is optional if you want to use the reduced data types. Reduced Type is one of SAMPLE, MIN, MAX, AVG, or STDDEV.</p>
<p>Adding packets to stream is done as follows:</p>
<div class="language-javascript codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-javascript codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token keyword" style="color:rgb(127, 219, 202)">var</span><span class="token plain"> packets </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"RAW__TLM__INST__ADCS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"0"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__TLM__INST__HEALTH_STATUS__FORMATTED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"1"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token maybe-class-name">OpenC3Auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">updateToken</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">OpenC3Auth</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">defaultMinValidity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(127, 219, 202)">=></span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">subscription</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">perform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">"add"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">scope</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">openc3Scope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">token</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(214, 222, 235)">localStorage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">openc3Token</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">packets</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> packets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">start_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">startDateTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token literal-property property" style="color:rgb(128, 203, 196)">end_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">endDateTime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br/></span></code></pre></div></div>
<p>The values in the packet name are separated by double underscores, e.g. <code>&lt;MODE>__&lt;CMD or TLM>__&lt;TARGET NAME>__&lt;PACKET NAME>__&lt;VALUE TYPE></code>. Mode is either RAW or DECOM. The next parameter is CMD or TLM followed by the target and packet names. The Value Type is one of RAW, CONVERTED or FORMATTED.</p>
<p>For Raw mode, VALUE TYPE should be set to RAW or omitted (e.g. TLM__INST__ADCS__RAW or TLM__INST__ADCS).
start_time and end_time are standard COSMOS 64-bit integer timestamps in nanoseconds since the Unix Epoch (midnight January 1st, 1970). If start_time is null, that indicates to start streaming from the current time in realtime, indefinitely until items are removed, or the subscription is unsubscribed. end_time is ignored if start_time is null. If start_time is given and end_time is null, that indicates to playback from the given starttime and then continue indefinitely in realtime. If both start_time and end_time are given, then that indicates a temporary playback of historical data.</p>
<p>Data returned by the streaming API is handled by the received callback in Javascript. Data is returned as a JSON Array, with a JSON object in the array for each packet returned. Results are batched, and the current implementation will return up to 100 packets in each batch (the array will have 100 entries). 100 packets per batch is not guaranteed, and batches may take on varying sizes based on the size of the data returned, or other factors. An empty array indicates that all data has been sent for a purely historical query and can be used as an end of data indicator.</p>
<p>For decommutated items, each packet is represented as a JSON object with a 'time' field holding the COSMOS nanosecond timestamp of the packet, and then each of the requested item keys with their corresponding value from the packet.</p>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1234657585858</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"TLM__INST__ADCS__Q1__RAW"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"TLM__INST__ADCS__Q2__RAW"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100.0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1234657585859</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"TLM__INST__ADCS__Q1__RAW"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"TLM__INST__ADCS__Q2__RAW"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">110.0</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<p>For raw packets, each packet is represented as a JSON object with a time field holding the COSMOS nanosecond timestamp of the packet, a packet field holding the topic the packet was read from in the form of SCOPE__TELEMETRY__TARGETNAME__PACKETNAME, and a buffer field holding a BASE64 encoded copy of the packet data.</p>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1234657585858</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"packet"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"DEFAULT__TELEMETRY__INST__ADCS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"buffer"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"SkdfjGodkdfjdfoekfsg"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1234657585859</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"packet"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"DEFAULT__TELEMETRY__INST__ADCS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token property" style="color:rgb(128, 203, 196)">"buffer"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"3i5n49dmnfg9fl32k3"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=ruby-example>Ruby Example<a href=#ruby-example class=hash-link aria-label="Direct link to Ruby Example" title="Direct link to Ruby Example" translate=no>​</a></h2>
<p>Below is a simple Ruby example for using the streaming API to retrieve telemetry data:</p>
<div class="language-ruby codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-ruby codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token keyword" style="color:rgb(127, 219, 202)">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'openc3'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'openc3/script/web_socket_api'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token variable" style="color:rgb(214, 222, 235)">$openc3_scope</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'DEFAULT'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token constant" style="color:rgb(130, 170, 255)">ENV</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'OPENC3_API_HOSTNAME'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'127.0.0.1'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token constant" style="color:rgb(130, 170, 255)">ENV</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'OPENC3_API_PORT'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'2900'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token constant" style="color:rgb(130, 170, 255)">ENV</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'OPENC3_API_PASSWORD'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'password'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># The following are needed for Enterprise (change user/pass as necessary)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ENV['OPENC3_API_USER'] = 'operator'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ENV['OPENC3_API_PASSWORD'] = 'operator'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ENV['OPENC3_KEYCLOAK_REALM'] = 'openc3'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">#ENV['OPENC3_KEYCLOAK_URL'] = 'http://127.0.0.1:2900/auth'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Open a file to write CSV data</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">csv </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">File</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'telemetry_data.csv'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'w'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Connect to the streaming API</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">OpenC3</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token class-name" style="color:rgb(255, 203, 139)">StreamingWebSocketApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">api</span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Add items to stream - request data from yesterday to 1 minute ago</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token symbol">items</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'DECOM__TLM__INST__HEALTH_STATUS__TEMP1__CONVERTED'</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">'DECOM__TLM__INST__HEALTH_STATUS__TEMP2__CONVERTED'</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token symbol">start_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">Time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">now </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">86400</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to_nsec_from_epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># 24 hours ago</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token symbol">end_time</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token builtin" style="color:rgb(130, 170, 255)">Time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">now </span><span class="token operator" style="color:rgb(127, 219, 202)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">to_nsec_from_epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">       </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># 1 minute ago</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Write CSV header</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">"Time,TEMP1,TEMP2"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Read all data from the stream</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  data </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">read</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain" style=display:inline-block></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Process each data point</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="color:rgb(127, 219, 202)">each</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain">item</span><span class="token operator" style="color:rgb(127, 219, 202)">|</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">puts </span><span class="token string-literal string" style="color:rgb(173, 219, 103)">"</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">#{</span><span class="token string-literal interpolation content">item</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal interpolation content string-literal string" style="color:rgb(173, 219, 103)">'__time'</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string-literal interpolation content operator" style="color:rgb(127, 219, 202)">/</span><span class="token string-literal interpolation content number" style="color:rgb(247, 140, 108)">1</span><span class="token string-literal interpolation content">_000_000_000</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token string-literal interpolation content number" style="color:rgb(247, 140, 108)">0</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">,</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">#{</span><span class="token string-literal interpolation content">item</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal interpolation content string-literal string" style="color:rgb(173, 219, 103)">'DECOM__TLM__INST__HEALTH_STATUS__TEMP1__CONVERTED'</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">,</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">#{</span><span class="token string-literal interpolation content">item</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string-literal interpolation content string-literal string" style="color:rgb(173, 219, 103)">'DECOM__TLM__INST__HEALTH_STATUS__TEMP2__CONVERTED'</span><span class="token string-literal interpolation content punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string-literal interpolation delimiter punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token string-literal string" style="color:rgb(173, 219, 103)">"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">csv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=streamingapi-architecture>StreamingApi Architecture<a href=#streamingapi-architecture class=hash-link aria-label="Direct link to StreamingApi Architecture" title="Direct link to StreamingApi Architecture" translate=no>​</a></h2>
<p>The Streaming API is a server-side subsystem within the <code>openc3-cosmos-cmd-tlm-api</code> Rails microservice that provides real-time and historical telemetry/command data streaming to web clients over WebSockets (ActionCable). It supports streaming individual telemetry items, whole packets, and aggregated (reduced) data from multiple data sources: Valkey (Redis) streams, QuestDB (time-series database), and S3-compatible bucket log files.</p>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=architecture-diagram>Architecture Diagram<a href=#architecture-diagram class=hash-link aria-label="Direct link to Architecture Diagram" title="Direct link to Architecture Diagram" translate=no>​</a></h2>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│                        Web Client (Browser)                        │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│                    Vue.js Frontend (ActionCable JS)                 │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">└───────────────────────────────┬─────────────────────────────────────┘</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">                                │ WebSocket (AnyCable)</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">                                ▼</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│                     StreamingChannel (ActionCable)                  │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  app/channels/streaming_channel.rb                                 │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - subscribed() → creates StreamingApi instance                    │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - add(data) → delegates to StreamingApi#add                       │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - remove(data) → delegates to StreamingApi#remove                 │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - unsubscribed() → calls StreamingApi#kill                        │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">└───────────────────────────────┬─────────────────────────────────────┘</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">                                │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">                                ▼</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">┌─────────────────────────────────────────────────────────────────────┐</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│                        StreamingApi                                 │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  app/models/streaming_api.rb                                       │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - Orchestrates streaming threads                                  │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - Manages 0..1 RealtimeStreamingThread                            │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - Manages 0..N LoggedStreamingThread instances                    │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│  - Broadcasts results via ActionCable                              │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">└───────────┬───────────────────┬─────────────────────────────────────┘</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">            │                   │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">            ▼                   ▼</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">┌─────────────────────┐ ┌────────────────────────────────────────────┐</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│ RealtimeStreaming-   │ │ LoggedStreamingThread                      │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│ Thread               │ │ app/models/logged_streaming_thread.rb      │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│ app/models/realtime_ │ │ - Reads from QuestDB (TSDB mode)           │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│ streaming_thread.rb  │ │ - Reads from Valkey (STREAM mode)          │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│ - Reads from Valkey  │ │ - Reads from S3 files (RAW packets)        │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│   streams in real-   │ │ - Hands off to realtime when caught up     │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">│   time               │ │                                            │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">└──────────┬──────────┘ └────┬──────────────┬───────────────────────┘</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">           │                 │              │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">           ▼                 ▼              ▼</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    ┌──────────┐   ┌──────────────┐  ┌──────────────────────┐</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    │  Valkey   │   │   QuestDB    │  │ S3 Bucket Log Files  │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    │  Streams  │   │   (TSDB)     │  │ (via BucketFileCache │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    │           │   │              │  │  + PacketLogReader)  │</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    └──────────┘   └──────────────┘  └──────────────────────┘</span><br/></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=file-reference>File Reference<a href=#file-reference class=hash-link aria-label="Direct link to File Reference" title="Direct link to File Reference" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=primary-files-cmd-tlm-apiappmodels>Primary Files (cmd-tlm-api/app/models/)<a href=#primary-files-cmd-tlm-apiappmodels class=hash-link aria-label="Direct link to Primary Files (cmd-tlm-api/app/models/)" title="Direct link to Primary Files (cmd-tlm-api/app/models/)" translate=no>​</a></h3>
<table><thead><tr><th>File<th>Class<th>Purpose<tbody><tr><td><code>streaming_api.rb</code><td><code>StreamingApi</code><td>Top-level orchestrator. Manages thread lifecycle, item collections, and result transmission.<tr><td><code>streaming_thread.rb</code><td><code>StreamingThread</code><td>Abstract base class for streaming threads. Contains shared logic for Redis reading, message handling, batch transmission, and object lifecycle.<tr><td><code>realtime_streaming_thread.rb</code><td><code>RealtimeStreamingThread</code><td>Subclass of <code>StreamingThread</code>. Continuously reads from Valkey streams for live data.<tr><td><code>logged_streaming_thread.rb</code><td><code>LoggedStreamingThread</code><td>Subclass of <code>StreamingThread</code>. Reads historical data from QuestDB and/or Valkey, then hands off to realtime.<tr><td><code>streaming_object.rb</code><td><code>StreamingObject</code><td>Data class representing a single streaming subscription item (one item or one packet).<tr><td><code>streaming_object_collection.rb</code><td><code>StreamingObjectCollection</code><td>Thread-safe collection of <code>StreamingObject</code> instances, indexed by topic, id, and type.<tr><td><code>streaming_object_file_reader.rb</code><td><code>StreamingObjectFileReader</code><td>Reads raw packet data from S3 bucket log files in time order across multiple files.</table>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=channel-files-cmd-tlm-apiappchannels>Channel Files (cmd-tlm-api/app/channels/)<a href=#channel-files-cmd-tlm-apiappchannels class=hash-link aria-label="Direct link to Channel Files (cmd-tlm-api/app/channels/)" title="Direct link to Channel Files (cmd-tlm-api/app/channels/)" translate=no>​</a></h3>
<table><thead><tr><th>File<th>Class<th>Purpose<tbody><tr><td><code>streaming_channel.rb</code><td><code>StreamingChannel</code><td>ActionCable channel. Entry point for WebSocket streaming requests.<tr><td><code>application_cable/connection.rb</code><td><code>ApplicationCable::Connection</code><td>WebSocket connection authentication. Authorizes via token and assigns UUID/scope.<tr><td><code>application_cable/channel.rb</code><td><code>ApplicationCable::Channel</code><td>Base ActionCable channel class.</table>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=core-library-files-openc3libopenc3>Core Library Files (openc3/lib/openc3/)<a href=#core-library-files-openc3libopenc3 class=hash-link aria-label="Direct link to Core Library Files (openc3/lib/openc3/)" title="Direct link to Core Library Files (openc3/lib/openc3/)" translate=no>​</a></h3>
<table><thead><tr><th>File<th>Class<th>Purpose<tbody><tr><td><code>topics/topic.rb</code><td><code>OpenC3::Topic</code><td>Delegates to <code>EphemeralStore</code> (Valkey). Provides <code>read_topics</code>, <code>get_oldest_message</code>, <code>get_last_offset</code>.<tr><td><code>utilities/questdb_client.rb</code><td><code>OpenC3::QuestDBClient</code><td>QuestDB utility: value encoding/decoding, table/column name sanitization, timestamp formatting, sentinel value handling.<tr><td><code>utilities/bucket_file_cache.rb</code><td><code>BucketFileCache</code> / <code>BucketFile</code><td>Singleton cache for S3 bucket files. Downloads, caches locally, manages disk usage and file lifecycle.<tr><td><code>logs/buffered_packet_log_reader.rb</code><td><code>OpenC3::BufferedPacketLogReader</code><td>Reads packet log files with buffering to enable time-ordered reading across multiple files.<tr><td><code>packets/json_packet.rb</code><td><code>OpenC3::JsonPacket</code><td>Represents a decommutated packet as JSON. Provides <code>read()</code> and <code>read_all()</code> for extracting item values.<tr><td><code>utilities/authorization.rb</code><td><code>OpenC3::Authorization</code><td>Authorization mixin. Provides <code>authorize()</code> method for permission checks.<tr><td><code>models/target_model.rb</code><td><code>OpenC3::TargetModel</code><td>Target configuration model. Provides <code>get_item_to_packet_map()</code>, <code>packet()</code>, <code>packet_item()</code>.<tr><td><code>utilities/bucket_utilities.rb</code><td><code>OpenC3::BucketUtilities</code><td>S3 bucket utilities. Provides <code>files_between_time()</code> for finding log files in time ranges.</table>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=test-file>Test File<a href=#test-file class=hash-link aria-label="Direct link to Test File" title="Direct link to Test File" translate=no>​</a></h3>
<table><thead><tr><th>File<th>Purpose<tbody><tr><td><code>spec/models/streaming_api_spec.rb</code><td>RSpec tests covering realtime, logged, file-based, and reduced streaming scenarios.</table>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=data-structures>Data Structures<a href=#data-structures class=hash-link aria-label="Direct link to Data Structures" title="Direct link to Data Structures" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=streamingobject>StreamingObject<a href=#streamingobject class=hash-link aria-label="Direct link to StreamingObject" title="Direct link to StreamingObject" translate=no>​</a></h3>
<p>Represents a single subscription to either a telemetry/command item or a whole packet.</p>
<div class="language-ruby codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-ruby codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">StreamingObject</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:key</span><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Full key string, e.g. "DECOM__TLM__INST__ADCS__Q1__CONVERTED"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:stream_mode</span><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Symbol: :RAW, :DECOM, :REDUCED_MINUTE, :REDUCED_HOUR, :REDUCED_DAY</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:cmd_or_tlm</span><span class="token plain">     </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Symbol: :CMD or :TLM</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:target_name</span><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String: target name, e.g. "INST"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:packet_name</span><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String: packet name, e.g. "ADCS"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:item_name</span><span class="token plain">      </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String or nil: item name (nil for whole packets)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:value_type</span><span class="token plain">     </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Symbol: :RAW, :CONVERTED, :FORMATTED, :WITH_UNITS, :PURE</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:reduced_type</span><span class="token plain">   </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Symbol or nil: :MIN, :MAX, :AVG, :STDDEV (reduced modes only)</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_accessor </span><span class="token symbol">:start_time</span><span class="token plain">   </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Integer or nil: nanoseconds from epoch</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_accessor </span><span class="token symbol">:end_time</span><span class="token plain">     </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Integer or nil: nanoseconds from epoch</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_accessor </span><span class="token symbol">:offset</span><span class="token plain">       </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String: Valkey stream offset, e.g. "1614890937274-0"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:topic</span><span class="token plain">          </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String: Valkey topic, e.g. "DEFAULT__DECOM__{INST}__ADCS"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:id</span><span class="token plain">             </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String: unique id, e.g. "ITEM__DECOM__TLM__INST__ADCS__Q1__CONVERTED"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:realtime</span><span class="token plain">       </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Boolean: true if end_time is nil or in the future</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  attr_reader </span><span class="token symbol">:item_key</span><span class="token plain">       </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># String or nil: client-provided key for result mapping</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><br/></span></code></pre></div></div>
<p><strong>Key Format (Items):</strong></p>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">MODE__CMDORTLM__TARGET__PACKET__ITEM__VALUETYPE[__REDUCEDTYPE]</span><br/></span></code></pre></div></div>
<p>Examples:</p>
<ul>
<li class=""><code>DECOM__TLM__INST__ADCS__Q1__CONVERTED</code></li>
<li class=""><code>REDUCED_MINUTE__TLM__INST__PARAMS__VALUE1__RAW__AVG</code></li>
</ul>
<p><strong>Key Format (Packets):</strong></p>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">MODE__CMDORTLM__TARGET__PACKET__VALUETYPE</span><br/></span></code></pre></div></div>
<p>Examples:</p>
<ul>
<li class=""><code>RAW__TLM__INST__PARAMS</code></li>
<li class=""><code>DECOM__TLM__INST__PARAMS__CONVERTED</code></li>
</ul>
<p><strong>Topic Format:</strong></p>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">SCOPE__TYPE__{TARGET}__PACKET</span><br/></span></code></pre></div></div>
<p>Where TYPE is: <code>TELEMETRY</code>, <code>COMMAND</code>, <code>DECOM</code>, <code>DECOMCMD</code>, <code>REDUCED_MINUTE</code>, <code>REDUCED_HOUR</code>, or <code>REDUCED_DAY</code>.</p>
<p>Example: <code>DEFAULT__DECOM__{INST}__ADCS</code></p>
<p><strong>ID Format:</strong></p>
<ul>
<li class="">Items: <code>ITEM__&lt;key></code></li>
<li class="">Packets: <code>PACKET__&lt;key></code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=streamingobjectcollection>StreamingObjectCollection<a href=#streamingobjectcollection class=hash-link aria-label="Direct link to StreamingObjectCollection" title="Direct link to StreamingObjectCollection" translate=no>​</a></h3>
<p>Thread-safe collection that indexes StreamingObjects for efficient lookup.</p>
<div class="language-ruby codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-ruby codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token keyword" style="color:rgb(127, 219, 202)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">StreamingObjectCollection</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@objects</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Array&lt;StreamingObject> - all objects</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@objects_by_id</span><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Hash{String => StreamingObject} - lookup by object.id</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@topics_and_offsets</span><span class="token plain">       </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Hash{String => String} - topic => latest offset</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@item_objects_by_topic</span><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Hash{String => Array&lt;StreamingObject>} - items grouped by topic</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@packet_objects_by_topic</span><span class="token plain">  </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Hash{String => Array&lt;StreamingObject>} - packets grouped by topic</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@includes_realtime</span><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Boolean - true if any object has realtime == true</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token variable" style="color:rgb(214, 222, 235)">@mutex</span><span class="token plain">                    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic"># Mutex - protects all internal state</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token keyword" style="color:rgb(127, 219, 202)">end</span><br/></span></code></pre></div></div>
<p><strong>Offset management:</strong> Both <code>add()</code> and <code>topics_offsets_and_objects()</code> use max-offset-per-topic logic: when multiple objects share a topic, the highest offset is kept. This ensures <code>XREAD</code> starts from the most advanced position, avoiding re-reading messages already processed by all objects on that topic. The <code>topics_offsets_and_objects()</code> method rebuilds the offset map from scratch on each call to reflect the latest object offsets.</p>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=client-request-format-add>Client Request Format (add)<a href=#client-request-format-add class=hash-link aria-label="Direct link to Client Request Format (add)" title="Direct link to Client Request Format (add)" translate=no>​</a></h3>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"scope"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"DEFAULT"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"token"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"&lt;auth_token>"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"start_time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1614890937274290500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"end_time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1614891537276524900</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"items"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__TLM__INST__ADCS__Q1__CONVERTED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"optional_item_key"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__TLM__INST__ADCS__Q2__RAW"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token null keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"packets"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(173, 219, 103)">"RAW__TLM__INST__PARAMS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"DECOM__TLM__INST__PARAMS__CONVERTED"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br/></span></code></pre></div></div>
<ul>
<li class=""><code>start_time</code>: 64-bit nanoseconds from Unix epoch. Omit for realtime-only.</li>
<li class=""><code>end_time</code>: 64-bit nanoseconds from Unix epoch. Omit to stream indefinitely.</li>
<li class=""><code>items</code>: Array of <code>[key, item_key]</code> pairs. <code>item_key</code> is used as the key in result JSON (defaults to key string if null).</li>
<li class=""><code>packets</code>: Array of key strings for whole-packet streaming.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=result-transmission-format>Result Transmission Format<a href=#result-transmission-format class=hash-link aria-label="Direct link to Result Transmission Format" title="Direct link to Result Transmission Format" translate=no>​</a></h3>
<p>Results are broadcast as JSON arrays via ActionCable. Each entry is one of:</p>
<p><strong>Item Result:</strong></p>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"__type"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"ITEMS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"__time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1614890937274290500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"COSMOS_EXTRA"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"{...}"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"item_key_1"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42.5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"item_key_2"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"ENABLED"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br/></span></code></pre></div></div>
<p><strong>Packet Result (decom/raw):</strong></p>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"__type"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"PACKET"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"__packet"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"RAW__TLM__INST__PARAMS"</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"__time"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1614890937274290500</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  </span><span class="token property" style="color:rgb(128, 203, 196)">"buffer"</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">"&lt;base64_encoded>"</span><span class="token plain"></span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br/></span></code></pre></div></div>
<p><strong>Stream Complete Marker:</strong></p>
<div class="language-json codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-json codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br/></span></code></pre></div></div>
<p>An empty array signals that all streaming threads have completed.</p>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-model>Thread Model<a href=#thread-model class=hash-link aria-label="Direct link to Thread Model" title="Direct link to Thread Model" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-hierarchy>Thread Hierarchy<a href=#thread-hierarchy class=hash-link aria-label="Direct link to Thread Hierarchy" title="Direct link to Thread Hierarchy" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">ActionCable WebSocket Connection (managed by AnyCable/Rails)</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  └── StreamingApi instance (1 per WebSocket subscription)</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        ├── RealtimeStreamingThread (0 or 1, singleton per StreamingApi)</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        │     └── Ruby Thread: runs redis_thread_body() in a loop</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        └── LoggedStreamingThread[] (0..N, one per add() call with start_time)</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">              └── Ruby Thread: runs thread_body() in a loop</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">                    (cycles through SETUP → TSDB → STREAM modes)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-1-realtimestreamingthread>Thread 1: RealtimeStreamingThread<a href=#thread-1-realtimestreamingthread class=hash-link aria-label="Direct link to Thread 1: RealtimeStreamingThread" title="Direct link to Thread 1: RealtimeStreamingThread" translate=no>​</a></h3>
<p><strong>File:</strong> <code>realtime_streaming_thread.rb</code> (extends <code>streaming_thread.rb</code>)</p>
<p><strong>Lifecycle:</strong></p>
<ol>
<li class="">Created when <code>add()</code> is called with no <code>start_time</code>, or when <code>end_time</code> is in the future.</li>
<li class="">At most one instance exists per <code>StreamingApi</code>. New add requests merge into the existing thread's collection.</li>
<li class="">Runs <code>redis_thread_body()</code> in an infinite loop.</li>
<li class="">Stops when all objects are removed or <code>kill()</code> is called.</li>
</ol>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Calls <code>OpenC3::Topic.read_topics()</code> (Valkey XREAD) with a 500ms timeout.</li>
<li class="">Skips stored packets (<code>msg_hash["stored"] == true</code>).</li>
<li class="">Processes items and packets from each message.</li>
<li class="">Batches results up to <code>@max_batch_size</code> (default 100) before transmitting.</li>
<li class="">Calls <code>check_for_completed_objects()</code> when no data is received (to detect wall-clock end-time expiry).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-2-loggedstreamingthread>Thread 2: LoggedStreamingThread<a href=#thread-2-loggedstreamingthread class=hash-link aria-label="Direct link to Thread 2: LoggedStreamingThread" title="Direct link to Thread 2: LoggedStreamingThread" translate=no>​</a></h3>
<p><strong>File:</strong> <code>logged_streaming_thread.rb</code> (extends <code>streaming_thread.rb</code>)</p>
<p><strong>Lifecycle:</strong></p>
<ol>
<li class="">Created when <code>add()</code> is called with a <code>start_time</code>.</li>
<li class="">Multiple instances can exist simultaneously (one per <code>add()</code> call with <code>start_time</code>).</li>
<li class="">Progresses through three modes: <code>SETUP</code> → <code>TSDB</code> or <code>STREAM</code> → <code>STREAM</code>.</li>
<li class="">After catching up, hands off objects to the <code>RealtimeStreamingThread</code> (if the objects have no <code>end_time</code> or <code>end_time</code> is in the future).</li>
<li class="">Stops when all objects expire or handoff completes.</li>
</ol>
<p><strong>Mode: SETUP</strong> (<code>setup_thread_body</code>)</p>
<ul>
<li class="">Validates that <code>start_time</code> is not more than 1 minute in the future.</li>
<li class="">Queries Valkey for the oldest message on the first object's topic.</li>
<li class="">Decision logic:<!-- -->
<ul>
<li class="">If <code>start_time &lt; oldest_time_in_valkey</code> → switch to <strong>TSDB</strong> mode (data is too old for Valkey).</li>
<li class="">If <code>start_time >= oldest_time_in_valkey</code> → switch to <strong>STREAM</strong> mode (data is in Valkey). Calculates a Valkey stream offset by interpolating between Redis time and packet time.</li>
<li class="">If no data in Valkey → switch to <strong>TSDB</strong> mode.</li>
</ul>
</li>
</ul>
<p><strong>Mode: TSDB</strong> (<code>tsdb_thread_body</code>)</p>
<ul>
<li class="">Separates objects into regular items, reduced items, and packets.</li>
<li class="">Regular items: Queries QuestDB with <code>SELECT</code> + <code>ASOF JOIN</code> across tables, type-aware decoding via <code>QuestDBClient.decode_value()</code>.</li>
<li class="">Reduced items: Queries QuestDB with <code>SAMPLE BY</code> aggregation (min, max, avg, stddev) at minute/hour/day intervals.</li>
<li class="">Packets:<!-- -->
<ul>
<li class="">RAW packets → reads from S3 log files via <code>StreamingObjectFileReader</code>.</li>
<li class="">DECOM packets → queries QuestDB with <code>SELECT *</code>.</li>
<li class="">REDUCED packets → queries QuestDB with <code>SAMPLE BY</code>.</li>
</ul>
</li>
<li class="">Uses paginated queries (<code>LIMIT min, max</code>) with batch size of 600.</li>
<li class="">Retries on <code>IOError</code> or <code>PG::Error</code> up to 5 times with connection reset.</li>
<li class="">Tracks the latest packet timestamp per topic in <code>@last_tsdb_times</code> (Hash<!-- -->).</li>
<li class="">After completion, calls <code>bridge_tsdb_to_stream()</code> to calculate Valkey stream offsets, then switches to <strong>STREAM</strong> mode.</li>
</ul>
<p><strong>TSDB→STREAM Bridge</strong> (<code>bridge_tsdb_to_stream</code>)</p>
<p>The offset interpolation between TSDB packet timestamps and Valkey stream IDs is approximate (Valkey IDs are wall-clock insertion times, while packet times are generation times). To prevent gaps:</p>
<ol>
<li class="">For each topic with recorded TSDB data, queries <code>OpenC3::Topic.get_oldest_message(topic)</code> to get the reference mapping between Valkey stream ID and packet timestamp.</li>
<li class="">Applies the same linear interpolation formula as <code>setup_thread_body</code>: <code>offset = ((last_tsdb_time - TSDB_STREAM_OVERLAP_NSEC + delta) / 1_000_000).to_s + '-0'</code>.</li>
<li class="">Subtracts a 2-second overlap buffer (<code>TSDB_STREAM_OVERLAP_NSEC</code>) to ensure the Valkey read starts before where TSDB left off. The overlap filtering in <code>redis_thread_body</code> deduplicates.</li>
<li class="">Sets each object's offset to the calculated value for its topic. Topics without TSDB data retain their existing offsets.</li>
</ol>
<p><strong>Mode: STREAM</strong> (<code>redis_thread_body</code> overridden from <code>StreamingThread</code>)</p>
<ul>
<li class="">On the first iteration after TSDB→STREAM transition, filters overlap per topic: messages with <code>time &lt;= @last_tsdb_times[topic]</code> are skipped (offsets still advance). Once a message passes the filter for a topic, that topic's filter is cleared.</li>
<li class="">After all per-topic filters are cleared, delegates to the parent <code>redis_thread_body</code> (same as RealtimeStreamingThread).</li>
<li class="">After each iteration, calls <code>attempt_handoff_to_realtime()</code> to transfer objects.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-3-bucketfilecache-thread>Thread 3: BucketFileCache Thread<a href=#thread-3-bucketfilecache-thread class=hash-link aria-label="Direct link to Thread 3: BucketFileCache Thread" title="Direct link to Thread 3: BucketFileCache Thread" translate=no>​</a></h3>
<p><strong>File:</strong> <code>openc3/lib/openc3/utilities/bucket_file_cache.rb</code></p>
<p><strong>Lifecycle:</strong> Singleton background thread, created on first access. Lives for the duration of the process.</p>
<p><strong>Behavior:</strong></p>
<ul>
<li class="">Dequeues files from <code>@queued_bucket_files</code> and downloads them from S3 to local temp directory.</li>
<li class="">Manages disk usage up to <code>MAX_DISK_USAGE</code> (default 20GB, configurable via <code>OPENC3_BUCKET_FILE_CACHE_SIZE</code>).</li>
<li class="">Periodically age-checks files (every 3600 seconds) and deletes unreserved files older than 4 hours.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-synchronization>Thread Synchronization<a href=#thread-synchronization class=hash-link aria-label="Direct link to Thread Synchronization" title="Direct link to Thread Synchronization" translate=no>​</a></h3>
<table><thead><tr><th>Mutex<th>Scope<th>Protects<tbody><tr><td><code>StreamingApi#@mutex</code><td>Per StreamingApi instance<td><code>@realtime_thread</code>, <code>@logged_threads</code> array, handoff operations<tr><td><code>StreamingObjectCollection#@mutex</code><td>Per collection<td><code>@objects</code>, <code>@objects_by_id</code>, <code>@topics_and_offsets</code>, <code>@item_objects_by_topic</code>, <code>@packet_objects_by_topic</code><tr><td><code>LoggedStreamingThread.@@conn_mutex</code><td>Class-level (shared across all instances)<td><code>@@conn</code> - shared PG::Connection to QuestDB<tr><td><code>BucketFileCache.@@mutex</code><td>Singleton<td><code>@queued_bucket_files</code>, <code>@bucket_file_hash</code>, <code>@current_disk_usage</code><tr><td><code>BucketFile#@mutex</code><td>Per file<td><code>@reservation_count</code>, <code>@local_path</code>, file retrieval</table>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=thread-shutdown-kill>Thread Shutdown (<code>kill</code>)<a href=#thread-shutdown-kill class=hash-link aria-label="Direct link to thread-shutdown-kill" title="Direct link to thread-shutdown-kill" translate=no>​</a></h3>
<ol>
<li class="">Calls <code>stop()</code> on the realtime thread and all logged threads (sets <code>@cancel_thread = true</code>).</li>
<li class="">Waits up to ~1.1 seconds for each thread to exit (polling at 10ms intervals).</li>
<li class="">Clears references: <code>@realtime_thread = nil</code>, <code>@logged_threads = []</code>.</li>
<li class="">Threads self-cleanup via <code>ensure</code> block calling <code>@streaming_api.complete_thread(self)</code>.</li>
</ol>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=data-flow>Data Flow<a href=#data-flow class=hash-link aria-label="Direct link to Data Flow" title="Direct link to Data Flow" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=realtime-streaming-no-start_time>Realtime Streaming (no start_time)<a href=#realtime-streaming-no-start_time class=hash-link aria-label="Direct link to Realtime Streaming (no start_time)" title="Direct link to Realtime Streaming (no start_time)" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">Client add(data) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  StreamingApi#add →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Build StreamingObjectCollection →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Create/reuse RealtimeStreamingThread →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      Loop:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        OpenC3::Topic.read_topics (Valkey XREAD, 500ms timeout) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        For each message:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Skip if stored == true</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          handle_message() → handle_json_packet() or handle_raw_packet() →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Batch results up to max_batch_size →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        transmit_results() →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          ActionCable.server.broadcast(subscription_key, results)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=historical--realtime-streaming-with-start_time-no-end_time>Historical → Realtime Streaming (with start_time, no end_time)<a href=#historical--realtime-streaming-with-start_time-no-end_time class=hash-link aria-label="Direct link to Historical → Realtime Streaming (with start_time, no end_time)" title="Direct link to Historical → Realtime Streaming (with start_time, no end_time)" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">Client add(data) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  StreamingApi#add →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Build StreamingObjectCollection →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Create LoggedStreamingThread →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      SETUP: Check Valkey for oldest message →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        If data too old → TSDB mode:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Query QuestDB (items, packets, reduced) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Track @last_tsdb_times per topic →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Transmit batched results →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          bridge_tsdb_to_stream():</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">            For each topic with TSDB data:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">              Look up oldest Valkey message for that topic →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">              Interpolate offset with 2s overlap buffer →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">              Set object offsets for that topic →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Switch to STREAM mode</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        If data in Valkey → STREAM mode:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Calculate start offset →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      STREAM mode:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        redis_thread_body() reads from Valkey →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          If @last_tsdb_times has entries for this topic:</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">            Skip messages with time &lt;= last_tsdb_time (advance offsets) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">            Clear filter once past overlap →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Process and transmit batched results →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      attempt_handoff_to_realtime() →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        StreamingApi#handoff_to_realtime() →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          Transfer objects to RealtimeStreamingThread →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          LoggedStreamingThread exits</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=historical-only-with-start_time-and-past-end_time>Historical Only (with start_time and past end_time)<a href=#historical-only-with-start_time-and-past-end_time class=hash-link aria-label="Direct link to Historical Only (with start_time and past end_time)" title="Direct link to Historical Only (with start_time and past end_time)" translate=no>​</a></h3>
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">Client add(data) →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">  StreamingApi#add →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Build StreamingObjectCollection →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">    Create LoggedStreamingThread →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">      SETUP → TSDB/STREAM →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        Stream data within time range →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        objects_active?() detects end_time exceeded →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        finish() removes completed objects →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        Thread exits →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">        complete_thread() →</span><br/></span><span class=token-line style=color:#d6deeb><span class="token plain">          transmit_results([], force: true)  (empty array = stream complete)</span><br/></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=latest-item-resolution>LATEST Item Resolution<a href=#latest-item-resolution class=hash-link aria-label="Direct link to LATEST Item Resolution" title="Direct link to LATEST Item Resolution" translate=no>​</a></h3>
<p>When an item key contains <code>LATEST</code> as the packet name (e.g., <code>DECOM__TLM__INST__LATEST__TEMP1__CONVERTED</code>), the <code>build_item_collection()</code> method resolves it:</p>
<ol>
<li class="">Calls <code>OpenC3::TargetModel.get_item_to_packet_map(target_name)</code> to find all packets containing that item.</li>
<li class="">Creates one <code>StreamingObject</code> per packet, each sharing the same <code>item_key</code> for result mapping.</li>
<li class="">The client receives whichever packet updates first (all map to the same output key).</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=handoff-logged--realtime>Handoff: Logged → Realtime<a href=#handoff-logged--realtime class=hash-link aria-label="Direct link to Handoff: Logged → Realtime" title="Direct link to Handoff: Logged → Realtime" translate=no>​</a></h3>
<p>The handoff mechanism in <code>StreamingThread#handoff()</code> compares offsets between the logged thread's collection and the realtime thread's collection:</p>
<ol>
<li class="">For each topic in the logged collection (indexed by <code>index</code>):<!-- -->
<ul>
<li class="">Looks up the topic's position in the realtime collection (<code>my_index = my_topics.index(topic)</code>).</li>
<li class="">If the realtime thread has the same topic and the logged offset (<code>offsets[index]</code>) >= realtime offset (<code>my_offsets[my_index]</code>) → <strong>caught up</strong>, transfer objects.</li>
<li class="">If the realtime thread doesn't have this topic → <strong>new topic</strong>, transfer objects.</li>
<li class="">If the logged offset &lt; realtime offset → <strong>not caught up</strong>, keep in logged thread.</li>
</ul>
</li>
<li class="">Objects are moved from the logged collection to the realtime collection.</li>
<li class="">If all objects are transferred, the logged thread cancels itself.</li>
</ol>
<p><strong>Note:</strong> The offset comparison uses <code>my_index</code> (the topic's position in the realtime collection) to look up <code>my_offsets</code>, not <code>index</code> (the logged collection's position). These differ when the two collections have topics in different orders.</p>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=data-sources>Data Sources<a href=#data-sources class=hash-link aria-label="Direct link to Data Sources" title="Direct link to Data Sources" translate=no>​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=1-valkey-redis-streams>1. Valkey (Redis) Streams<a href=#1-valkey-redis-streams class=hash-link aria-label="Direct link to 1. Valkey (Redis) Streams" title="Direct link to 1. Valkey (Redis) Streams" translate=no>​</a></h3>
<ul>
<li class=""><strong>Used by:</strong> <code>RealtimeStreamingThread</code>, <code>LoggedStreamingThread</code> (STREAM mode)</li>
<li class=""><strong>Access:</strong> <code>OpenC3::Topic.read_topics()</code> (wraps <code>EphemeralStore.read_topics</code> / Valkey XREAD)</li>
<li class=""><strong>Topics:</strong> <code>SCOPE__TYPE__{TARGET}__PACKET</code> (e.g., <code>DEFAULT__DECOM__{INST}__ADCS</code>)</li>
<li class=""><strong>Message Fields:</strong>
<ul>
<li class=""><code>time</code> - packet timestamp (nanoseconds)</li>
<li class=""><code>stored</code> - boolean, true for non-realtime packets</li>
<li class=""><code>buffer</code> - raw binary data (RAW mode)</li>
<li class=""><code>json_data</code> - JSON string of decommutated values (DECOM mode)</li>
<li class=""><code>extra</code> - optional JSON metadata (COSMOS_EXTRA)</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=2-questdb-time-series-database>2. QuestDB (Time-Series Database)<a href=#2-questdb-time-series-database class=hash-link aria-label="Direct link to 2. QuestDB (Time-Series Database)" title="Direct link to 2. QuestDB (Time-Series Database)" translate=no>​</a></h3>
<ul>
<li class=""><strong>Used by:</strong> <code>LoggedStreamingThread</code> (TSDB mode)</li>
<li class=""><strong>Access:</strong> <code>PG::Connection</code> via PostgreSQL wire protocol</li>
<li class=""><strong>Connection:</strong> Shared class-level <code>@@conn</code> protected by <code>@@conn_mutex</code></li>
<li class=""><strong>Environment Variables:</strong>
<ul>
<li class=""><code>OPENC3_TSDB_HOSTNAME</code> - QuestDB host</li>
<li class=""><code>OPENC3_TSDB_QUERY_PORT</code> - PostgreSQL query port</li>
<li class=""><code>OPENC3_TSDB_USERNAME</code> / <code>OPENC3_TSDB_PASSWORD</code> - credentials</li>
</ul>
</li>
<li class=""><strong>Table Names:</strong> <code>CMDORTLM__TARGET__PACKET</code> (sanitized), e.g., <code>TLM__INST__PARAMS</code></li>
<li class=""><strong>Query Patterns:</strong>
<ul>
<li class="">Items: <code>SELECT col1, col2, ... FROM T0 [ASOF JOIN T1 ...] WHERE T0.PACKET_TIMESECONDS >= X LIMIT min, max</code></li>
<li class="">Packets: <code>SELECT * FROM table WHERE PACKET_TIMESECONDS >= X LIMIT min, max</code></li>
<li class="">Reduced: <code>SELECT min(col), max(col), avg(col), stddev(col) FROM table WHERE ... SAMPLE BY 1m|1h|1d ALIGN TO CALENDAR ORDER BY PACKET_TIMESECONDS LIMIT min, max</code></li>
</ul>
</li>
<li class=""><strong>Type Mapping:</strong> Uses <code>PG::BasicTypeMapForResults</code> for automatic type conversion, plus <code>QuestDBClient.decode_value()</code> for COSMOS-specific types (arrays, blocks, 64-bit integers, sentinel float values).</li>
<li class=""><strong>Retry Logic:</strong> Up to 5 retries on <code>IOError</code> or <code>PG::Error</code>, with connection reset between retries.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RY7L" id=3-s3-bucket-log-files>3. S3 Bucket Log Files<a href=#3-s3-bucket-log-files class=hash-link aria-label="Direct link to 3. S3 Bucket Log Files" title="Direct link to 3. S3 Bucket Log Files" translate=no>​</a></h3>
<ul>
<li class=""><strong>Used by:</strong> <code>LoggedStreamingThread</code> → <code>StreamingObjectFileReader</code> (RAW packet mode only)</li>
<li class=""><strong>Access:</strong> <code>BucketFileCache</code> (singleton) → <code>OpenC3::Bucket</code> (S3 client)</li>
<li class=""><strong>File Format:</strong> Compressed binary log files (<code>.bin.gz</code>) in bucket paths like:<!-- -->
<div class="language-text codeBlockContainer_d67u theme-code-block" style=--prism-color:#d6deeb;--prism-background-color:#011627><div class=codeBlockContent_h_fg><pre tabindex=0 class="prism-code language-text codeBlock_tuGp thin-scrollbar" style=color:#d6deeb;background-color:#011627><code class=codeBlockLines_D9ES><span class=token-line style=color:#d6deeb><span class="token plain">SCOPE/stream_mode_logs/cmd_or_tlm/TARGET/YYYYMMDD/TIMESTAMP__TIMESTAMP__SCOPE__TARGET__PACKET__rt__mode.bin.gz</span><br/></span></code></pre></div></div>
</li>
<li class=""><strong>Reading:</strong> <code>BufferedPacketLogReader</code> with a buffer depth of 10 packets for time-ordered merging across multiple files.</li>
<li class=""><strong>File Discovery:</strong> <code>OpenC3::BucketUtilities.files_between_time()</code> lists files whose time ranges overlap the requested period.</li>
</ul>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=configuration>Configuration<a href=#configuration class=hash-link aria-label="Direct link to Configuration" title="Direct link to Configuration" translate=no>​</a></h2>
<table><thead><tr><th>Environment Variable<th>Default<th>Purpose<tbody><tr><td><code>OPENC3_LOGS_BUCKET</code><td>-<td>S3 bucket name for log files<tr><td><code>OPENC3_TSDB_HOSTNAME</code><td>-<td>QuestDB hostname<tr><td><code>OPENC3_TSDB_QUERY_PORT</code><td>-<td>QuestDB PostgreSQL wire protocol port<tr><td><code>OPENC3_TSDB_USERNAME</code><td>-<td>QuestDB username<tr><td><code>OPENC3_TSDB_PASSWORD</code><td>-<td>QuestDB password<tr><td><code>OPENC3_BUCKET_FILE_CACHE_SIZE</code><td><code>20000000000</code> (20GB)<td>Max local disk usage for cached bucket files</table>
<table><thead><tr><th>Constant<th>Value<th>Location<th>Purpose<tbody><tr><td><code>ALLOWABLE_START_TIME_OFFSET_NSEC</code><td>60 seconds (in ns)<td><code>LoggedStreamingThread</code><td>Max allowed start_time in the future<tr><td><code>TSDB_STREAM_OVERLAP_NSEC</code><td>2 seconds (in ns)<td><code>LoggedStreamingThread</code><td>Overlap buffer when bridging from TSDB to Valkey stream. Ensures no gaps from offset interpolation imprecision.<tr><td><code>max_batch_size</code> (realtime)<td>100<td><code>StreamingThread</code><td>Max results per ActionCable broadcast (realtime)<tr><td><code>max_batch_size</code> (logged)<td>600<td><code>LoggedStreamingThread</code><td>Max results per ActionCable broadcast (historical)<tr><td><code>BucketFile::MAX_AGE_SECONDS</code><td>14400 (4 hours)<td><code>BucketFileCache</code><td>Max age for unreserved cached files<tr><td><code>BucketFileCache::CHECK_TIME_SECONDS</code><td>3600 (1 hour)<td><code>BucketFileCache</code><td>Interval for age-checking cached files<tr><td><code>BufferedPacketLogReader buffer_depth</code><td>10<td><code>BufferedPacketLogReader</code><td>Number of packets buffered for time-ordered reading</table>
<hr/>
<h2 class="anchor anchorTargetStickyNavbar_RY7L" id=error-handling>Error Handling<a href=#error-handling class=hash-link aria-label="Direct link to Error Handling" title="Direct link to Error Handling" translate=no>​</a></h2>
<ul>
<li class=""><strong>Authorization errors</strong> (<code>OpenC3::AuthError</code>, <code>OpenC3::ForbiddenError</code>): Caught in <code>StreamingChannel</code>, transmit <code>{"error": "unauthorized"}</code> and reject the subscription.</li>
<li class=""><strong>General errors in <code>StreamingChannel</code></strong>: Transmit <code>{"error": "ClassName:message"}</code> and reject the subscription.</li>
<li class=""><strong>Thread crashes</strong>: Caught by <code>rescue => e</code> in <code>StreamingThread#start</code>. Logs error and calls <code>complete_thread(self)</code> via <code>ensure</code> block.</li>
<li class=""><strong>QuestDB connection errors</strong> (<code>IOError</code>, <code>PG::Error</code>): Retry up to 5 times with connection reset. Raise after 5th retry.</li>
<li class=""><strong>S3 retrieval errors</strong>: <code>BucketFile#retrieve</code> retries up to 3 times with 1-second sleep between attempts.</li>
<li class=""><strong>Start time too far in future</strong>: <code>LoggedStreamingThread</code> finishes objects and cancels if <code>start_time</code> exceeds current time by more than 60 seconds.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_DYK5"><a href=https://github.com/OpenC3/cosmos/tree/main/docs.openc3.com/docs/development/streaming-api.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_ppc9 aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_hqDB"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs/development/roadmap><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Roadmap</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs/development/testing><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Testing COSMOS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_LM4g thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#ruby-example class="table-of-contents__link toc-highlight">Ruby Example</a><li><a href=#streamingapi-architecture class="table-of-contents__link toc-highlight">StreamingApi Architecture</a><li><a href=#architecture-diagram class="table-of-contents__link toc-highlight">Architecture Diagram</a><li><a href=#file-reference class="table-of-contents__link toc-highlight">File Reference</a><ul><li><a href=#primary-files-cmd-tlm-apiappmodels class="table-of-contents__link toc-highlight">Primary Files (cmd-tlm-api/app/models/)</a><li><a href=#channel-files-cmd-tlm-apiappchannels class="table-of-contents__link toc-highlight">Channel Files (cmd-tlm-api/app/channels/)</a><li><a href=#core-library-files-openc3libopenc3 class="table-of-contents__link toc-highlight">Core Library Files (openc3/lib/openc3/)</a><li><a href=#test-file class="table-of-contents__link toc-highlight">Test File</a></ul><li><a href=#data-structures class="table-of-contents__link toc-highlight">Data Structures</a><ul><li><a href=#streamingobject class="table-of-contents__link toc-highlight">StreamingObject</a><li><a href=#streamingobjectcollection class="table-of-contents__link toc-highlight">StreamingObjectCollection</a><li><a href=#client-request-format-add class="table-of-contents__link toc-highlight">Client Request Format (add)</a><li><a href=#result-transmission-format class="table-of-contents__link toc-highlight">Result Transmission Format</a></ul><li><a href=#thread-model class="table-of-contents__link toc-highlight">Thread Model</a><ul><li><a href=#thread-hierarchy class="table-of-contents__link toc-highlight">Thread Hierarchy</a><li><a href=#thread-1-realtimestreamingthread class="table-of-contents__link toc-highlight">Thread 1: RealtimeStreamingThread</a><li><a href=#thread-2-loggedstreamingthread class="table-of-contents__link toc-highlight">Thread 2: LoggedStreamingThread</a><li><a href=#thread-3-bucketfilecache-thread class="table-of-contents__link toc-highlight">Thread 3: BucketFileCache Thread</a><li><a href=#thread-synchronization class="table-of-contents__link toc-highlight">Thread Synchronization</a><li><a href=#thread-shutdown-kill class="table-of-contents__link toc-highlight">Thread Shutdown (<code>kill</code>)</a></ul><li><a href=#data-flow class="table-of-contents__link toc-highlight">Data Flow</a><ul><li><a href=#realtime-streaming-no-start_time class="table-of-contents__link toc-highlight">Realtime Streaming (no start_time)</a><li><a href=#historical--realtime-streaming-with-start_time-no-end_time class="table-of-contents__link toc-highlight">Historical → Realtime Streaming (with start_time, no end_time)</a><li><a href=#historical-only-with-start_time-and-past-end_time class="table-of-contents__link toc-highlight">Historical Only (with start_time and past end_time)</a><li><a href=#latest-item-resolution class="table-of-contents__link toc-highlight">LATEST Item Resolution</a><li><a href=#handoff-logged--realtime class="table-of-contents__link toc-highlight">Handoff: Logged → Realtime</a></ul><li><a href=#data-sources class="table-of-contents__link toc-highlight">Data Sources</a><ul><li><a href=#1-valkey-redis-streams class="table-of-contents__link toc-highlight">1. Valkey (Redis) Streams</a><li><a href=#2-questdb-time-series-database class="table-of-contents__link toc-highlight">2. QuestDB (Time-Series Database)</a><li><a href=#3-s3-bucket-log-files class="table-of-contents__link toc-highlight">3. S3 Bucket Log Files</a></ul><li><a href=#configuration class="table-of-contents__link toc-highlight">Configuration</a><li><a href=#error-handling class="table-of-contents__link toc-highlight">Error Handling</a></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Homepage</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://openc3.com target=_blank rel="noopener noreferrer" class=footer__link-item>Home</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs>Documentation</a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.linkedin.com/company/openc3 target=_blank rel="noopener noreferrer" class=footer__link-item>LinkedIn<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_Hsa0><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/OpenC3/cosmos target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-label="(opens in new tab)" class=iconExternalLink_Hsa0><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a class=footer__link-item href=/docs/privacy>Privacy</a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2026 OpenC3, Inc.</div></div></div></footer></div></body>