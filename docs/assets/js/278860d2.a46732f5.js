"use strict";(self.webpackChunkdocs_openc3_com=self.webpackChunkdocs_openc3_com||[]).push([["3987"],{4848:function(e,n,t){t.r(n),t.d(n,{metadata:()=>s,default:()=>d,frontMatter:()=>i,contentTitle:()=>a,toc:()=>l,assets:()=>c});var s=JSON.parse('{"id":"guides/curl","title":"Testing with Curl","description":"How to use Curl to call COSMOS APIs","source":"@site/docs/guides/curl.md","sourceDirName":"guides","slug":"/guides/curl","permalink":"/docs/guides/curl","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenC3/cosmos/tree/main/docs.openc3.com/docs/guides/curl.md","tags":[],"version":"current","frontMatter":{"title":"Testing with Curl","description":"How to use Curl to call COSMOS APIs","sidebar_custom_props":{"myEmoji":"\u{1F30A}"}},"sidebar":"defaultSidebar","previous":{"title":"COSMOS and NASA cFS","permalink":"/docs/guides/cfs"},"next":{"title":"Custom Widgets","permalink":"/docs/guides/custom-widgets"}}'),r=t(2615),o=t(9496);let i={title:"Testing with Curl",description:"How to use Curl to call COSMOS APIs",sidebar_custom_props:{myEmoji:"\u{1F30A}"}},a,c={},l=[{value:"Curl Example with OpenC3 COSMOS Core",id:"curl-example-with-openc3-cosmos-core",level:2},{value:"Curl Example with OpenC3 COSMOS Enterprise",id:"curl-example-with-openc3-cosmos-enterprise",level:2},{value:"Using keyword_params for Method Options",id:"using-keyword_params-for-method-options",level:3},{value:"Refreshing the Access Token",id:"refreshing-the-access-token",level:3},{value:"Suite Runner Example",id:"suite-runner-example",level:2}];function p(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"The COSMOS APIs are all served over HTTP, which means you can use curl to experiment with them. Curl is a great tool for seeing exactly how the API responds to any given request."}),"\n",(0,r.jsx)(n.admonition,{title:"OpenC3 CLI is Available",type:"info",children:(0,r.jsxs)(n.p,{children:["Before diving too deeping into ",(0,r.jsx)(n.code,{children:"curl"})," make sure what you're trying to accomplish can't be achieved using the ",(0,r.jsx)(n.a,{href:"/docs/getting-started/cli",children:"OpenC3 CLI"}),". There are options to load plugins, spawn scripts, check script status, etc. This curl information is for developers or executing APIs calls outside the CLI."]})}),"\n",(0,r.jsx)(n.h2,{id:"curl-example-with-openc3-cosmos-core",children:"Curl Example with OpenC3 COSMOS Core"}),"\n",(0,r.jsx)(n.p,{children:"OpenC3 COSMOS Core just has a single user account, so all you need to do is pass the single password as the token with your requests like this."}),"\n",(0,r.jsx)(n.p,{children:"Request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -i -H "Content-Type: application/json-rpc" -H "Authorization: eyJhbGciOiJSUzI1NiIsInR5cCI...<access_token>" \\\n-d \'{"jsonrpc": "2.0", "method": "tlm", "params": ["INST HEALTH_STATUS TEMP1"], "keyword_params": {"scope": "DEFAULT"}, "id": 8}\' \\\n-X POST http://127.0.0.1:2900/openc3-api/api\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nCache-Control: max-age=0, private, must-revalidate\nContent-Length: 51\nContent-Type: application/json-rpc\nEtag: W/"e806aacfdbed0b325e7a5928e3bb5cf4"\nVary: Origin\nX-Request-Id: bbad6c6b-6d22-4374-a86f-b5b0b95e6939\nX-Runtime: 0.059044\nDate: Wed, 10 May 2023 00:40:40 GMT\n\n{"jsonrpc":"2.0","id":8,"result":53.26555000000001}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"curl-example-with-openc3-cosmos-enterprise",children:"Curl Example with OpenC3 COSMOS Enterprise"}),"\n",(0,r.jsx)(n.p,{children:"OpenC3 COSMOS Enterprise uses the Keycloak Single Sign-on system, so you must first request a token from Keycloak using a username and password pair, before you make requests. By default this token will expire in 5 minutes, and will need to be refreshed if it expires before your next request."}),"\n",(0,r.jsx)(n.p,{children:"Keycloak Request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Get tokens from Keycloak - You will need to update the username and password with your account\ncurl -i -H \"Content-Type: application/x-www-form-urlencoded\" \\\n-d 'username=operator&password=operator&client_id=api&grant_type=password' \\\n-X POST http://127.0.0.1:2900/auth/realms/openc3/protocol/openid-connect/token\n"})}),"\n",(0,r.jsx)(n.p,{children:"Keycloak Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nCache-Control: no-store\nContent-Length: 3207\nContent-Type: application/json\nPragma: no-cache\nReferrer-Policy: no-referrer\nSet-Cookie: KEYCLOAK_LOCALE=; Version=1; Comment=Expiring cookie; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Max-Age=0; Path=/auth/realms/openc3/; HttpOnly\nSet-Cookie: KC_RESTART=; Version=1; Expires=Thu, 01-Jan-1970 00:00:10 GMT; Max-Age=0; Path=/auth/realms/openc3/; HttpOnly\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nX-Content-Type-Options: nosniff\nX-Frame-Options: SAMEORIGIN\nX-Xss-Protection: 1; mode=block\nDate: Wed, 10 May 2023 00:40:40 GMT\n\n{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI...",\n "expires_in":300,\n "refresh_expires_in":1800,\n "refresh_token":"eyJhbGciOiJIUzI1NiIsInR5cCI...",\n "token_type":"Bearer",\n "not-before-policy":0,\n "session_state":"4qBpizFTTzm5ZVHfBTXWgRAH",\n "scope":"profile roles email"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"COSMOS Request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# COSMOS Request now looks like this:\n\ncurl -i -H "Content-Type: application/json-rpc" -H "Authorization: eyJhbGciOiJSUzI1NiIsInR5cCI...<access_token>" \\\n-d \'{"jsonrpc": "2.0", "method": "tlm", "params": ["INST HEALTH_STATUS TEMP1"], "keyword_params": {"scope": "DEFAULT"}, "id": 8}\' \\\n-X POST http://127.0.0.1:2900/openc3-api/api\n'})}),"\n",(0,r.jsx)(n.p,{children:"COSMOS Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nCache-Control: max-age=0, private, must-revalidate\nContent-Length: 42\nContent-Type: application/json-rpc\nEtag: W/"a1f1d2d7bc871f31c0c1977fb54778ca"\nVary: Origin\nX-Request-Id: 34b7adac-4134-429a-bd8f-e16268ea4204\nX-Runtime: 0.017652\nDate: Wed, 28 Jan 2026 14:47:46 GMT\n\n{"jsonrpc":"2.0","id":8,"result":-40.6714}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"using-keyword_params-for-method-options",children:"Using keyword_params for Method Options"}),"\n",(0,r.jsxs)(n.p,{children:["Many API methods accept keyword parameters for additional options beyond the standard ",(0,r.jsx)(n.code,{children:"scope"})," parameter. For example, the ",(0,r.jsx)(n.code,{children:"cmd"})," method accepts ",(0,r.jsx)(n.code,{children:"validate"}),", ",(0,r.jsx)(n.code,{children:"timeout"}),", and ",(0,r.jsx)(n.code,{children:"log_message"})," options. These are passed in the ",(0,r.jsx)(n.code,{children:"keyword_params"})," field of the JSON-RPC request."]}),"\n",(0,r.jsx)(n.p,{children:"Request (sending a command with validation disabled):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -i -H "Content-Type: application/json-rpc" -H "Authorization: eyJhbGciOiJSUzI1NiIsInR5cCI...<access_token>" \\\n-d \'{"jsonrpc": "2.0", "method": "cmd", "params": ["INST COLLECT with DURATION 10, TYPE NORMAL"], "keyword_params": {"scope": "DEFAULT", "validate": false}, "id": 9}\' \\\n-X POST http://127.0.0.1:2900/openc3-api/api\n'})}),"\n",(0,r.jsx)(n.p,{children:"Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nCache-Control: max-age=0, private, must-revalidate\nContent-Length: 42\nContent-Type: application/json-rpc\nEtag: W/"a1f1d2d7bc871f31c0c1977fb54778ca"\nVary: Origin\nX-Request-Id: 34b7adac-4134-429a-bd8f-e16268ea4204\nX-Runtime: 0.017652\nDate: Wed, 28 Jan 2026 14:47:46 GMT\n\n{"jsonrpc":"2.0","id":9,"result":{"target_name":"INST","cmd_name":"COLLECT",...}}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"refreshing-the-access-token",children:"Refreshing the Access Token"}),"\n",(0,r.jsxs)(n.p,{children:["When your access token expires (default: 5 minutes), you can use the refresh token to obtain a new access token without re-authenticating with username and password. The refresh token is returned in the initial authentication response above (",(0,r.jsx)(n.code,{children:"refresh_token"})," field)."]}),"\n",(0,r.jsx)(n.p,{children:"Refresh Token Request:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl -i -H \"Content-Type: application/x-www-form-urlencoded\" \\\n  -d 'client_id=api&grant_type=refresh_token&refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI...<refresh_token>' \\\n  -X POST http://127.0.0.1:2900/auth/realms/openc3/protocol/openid-connect/token\n"})}),"\n",(0,r.jsx)(n.p,{children:"Refresh Token Response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nCache-Control: no-store\nContent-Length: 1939\nContent-Type: application/json\nPragma: no-cache\nReferrer-Policy: no-referrer\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nX-Content-Type-Options: nosniff\nX-Frame-Options: SAMEORIGIN\nDate: Wed, 28 Jan 2026 14:50:06 GMT\n\n{"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCI...",\n "expires_in":300,\n "refresh_expires_in":1800,\n "refresh_token":"eyJhbGciOiJIUzUxMiIsInR5cCI...",\n "token_type":"Bearer",\n "not-before-policy":0,\n "session_state":"wtQcxD4YyzqlzBkmtRi7KTNm",\n "scope":"profile roles email"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The response contains both a new access token and a new refresh token. Each time you refresh, you receive a fresh refresh token, and the previous one is invalidated. The refresh token idle timeout (default: 30 minutes) is reset with each refresh request."}),"\n",(0,r.jsxs)(n.p,{children:["For more details on token types and lifespans, see ",(0,r.jsx)(n.a,{href:"/docs/getting-started/architecture#keycloak-enterprise",children:"Keycloak"})," in Architecture."]}),"\n",(0,r.jsx)(n.h2,{id:"suite-runner-example",children:"Suite Runner Example"}),"\n",(0,r.jsxs)(n.p,{children:["It can be very useful to run the a suite or script remotely from a continuous testing server. COSMOS' REST API allows for this. To figure out what is required to run a certain task on the web GUI you can open up your browser's developer tools to monitor the network traffic. You will see all the requests and responses required to run a command and you can reformat them yourself to suit your own purposes. Below is an example of running a test script from a Chromium-based browser:\n",(0,r.jsx)(n.img,{src:"https://github.com/OpenC3/cosmos/assets/55999897/df642d42-43e0-47f9-9b52-d42746d9746b",alt:"Network Traffic in browser developer tools"})]}),"\n",(0,r.jsxs)(n.p,{children:['You can see that there are 5 transactions total. To investigate just right-click on the network transaction and click "copy as ',(0,r.jsx)(n.code,{children:"curl"}),'" (depends on the browser). Here is an example of the second one:']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl 'http://localhost:2900/script-api/scripts/TARGET/procedures/cmd_tlm_test.rb/lock?scope=DEFAULT' \\\n  -X 'POST' \\\n  -H 'Accept: application/json' \\\n  -H 'Accept-Language: en-US,en;q=0.9' \\\n  -H 'Authorization: eyJhbGciOiJSUzI1NiIsInR5cCI...<access_token>' \\\n  -H 'Connection: keep-alive' \\\n  -H 'Content-Length: 0' \\\n  -H 'Origin: http://ascportal:2900' \\\n  -H 'Referer: http://localhost:2900/tools/scriptrunner/?file=TARGET%2Fprocedures%2Fcmd_tlm_test.rb' \\\n  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36 Edg/124.0.0.0' \\\n  --insecure\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Many of the browser-specific headers are not required. The important thing to notice here is the URL and the request (in this case ",(0,r.jsx)(n.code,{children:"POST"}),"). If we inspect all of these we'll find out what each one does:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Set the script contents","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"this updates any local changes)"}),"\n",(0,r.jsxs)(n.li,{children:["Note that this is a different request to ",(0,r.jsx)(n.code,{children:"GET"})," the script contents. This is done on the page load."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Lock the script (so other users can't edit it during execution)"}),"\n",(0,r.jsx)(n.li,{children:"Run script (this takes a JSON with options)"}),"\n",(0,r.jsx)(n.li,{children:"Open Websocket for logs"}),"\n",(0,r.jsx)(n.li,{children:"Request Result (this URL is a little different because the results are saved in redis)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Below is a bash script which does all the above given some options. It requires ",(0,r.jsx)(n.code,{children:"curl"})," for the web requests and ",(0,r.jsx)(n.code,{children:"jq"})," for JSON parsing and formatting. It locks and runs the script, continually checks its status, then requests the result."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -e\nTARGET=${1:-\'TARGET\'}\nSCRIPT=${2:-\'procedures/cmd_tlm_test.rb\'}\nSUITE=${3:-\'TestSuite\'}\nCOSMOS_HOST=\'http://localhost:2900\'\nSCRIPT_API="$COSMOS_HOST/script-api"\nSCRIPT_PATH="scripts/$TARGET/$SCRIPT"\nCURL_ARGS=(\n	-H \'Accept: application/json\'\n	-H \'Authorization: eyJhbGciOiJSUzI1NiIsInR5cCI...<access_token>\'\n	-H \'Accept-Language: en-US,en;q=0.9\'\n	-H \'Connection: keep-alive\'\n	-H \'Content-Type: application/json\'\n	--insecure\n	--silent )\n\n# Lock script #\ncurl "$SCRIPT_API/$SCRIPT_PATH/lock?scope=DEFAULT" -X "POST" "${CURL_ARGS[@]}"\n\n# Run script #\nRUN_OPTS=$(cat <<-json\n{\n  "environment": [],\n  "suiteRunner": {\n    "method": "start",\n    "suite": "$SUITE",\n    "options": [\n      "continueAfterError"\n    ]\n  }\n}\njson\n)\nRUN_OPTS=$(<<<"$RUN_OPTS" jq -rc .)\nID=$(curl "$SCRIPT_API/$SCRIPT_PATH/run?scope=DEFAULT" --data-raw "$RUN_OPTS" "${CURL_ARGS[@]}")\n\necho "Starting Script \'$SCRIPT_PATH\' at $(date) (may take up to 15 minutes)" > /dev/stderr\necho "You can monitor it in Script Runner here: $COSMOS_HOST/tools/scriptrunner/$ID" > /dev/stderr\n# Loop while Script ID is still running #\nwhile true; do\n	SCRIPT_STATUS="$(curl "$SCRIPT_API/running-script?scope=DEFAULT" "${CURL_ARGS[@]}" | jq ".[]|select(.id==$ID)")"\n	if [[ -z $SCRIPT_STATUS ]]; then\n		break;\n	fi\n	sleep 2\ndone\n\n# Request results #\nBUCKET_FILE_URI="$(curl "$SCRIPT_API/completed-scripts?scope=DEFAULT" "${CURL_ARGS[@]}" |\\\n	jq \'[.[]|select(.name | test("\'"${SCRIPT_PATH#scripts/}"\' "))][0] | .log | @uri\' -r)"\n\nURL="$(curl "$COSMOS_HOST/openc3-api/storage/download/$BUCKET_FILE_URI?bucket=OPENC3_LOGS_BUCKET&scope=DEFAULT" "${CURL_ARGS[@]}" |jq .url -r)"\n\ncurl "$COSMOS_HOST$URL" "${CURL_ARGS[@]}"\n'})})]})}function d(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},9496:function(e,n,t){t.d(n,{R:()=>i,x:()=>a});var s=t(9471);let r={},o=s.createContext(r);function i(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);