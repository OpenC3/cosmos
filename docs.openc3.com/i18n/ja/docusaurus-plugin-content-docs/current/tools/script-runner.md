---
title: スクリプトランナー
description: コマンドを送信してテレメトリをチェックするPythonまたはRubyスクリプトを実行
sidebar_custom_props:
  myEmoji: 🛠️
---

## はじめに

スクリプトランナーは、COSMOSスクリプトのエディタであると同時にスクリプトを実行します。スクリプトファイルはCOSMOSターゲット内に保存され、スクリプトランナーはこれらのファイルを開く、保存する、ダウンロードする、削除する機能を提供します。スクリプトのスイートが開かれると、スクリプトランナーは個々のスクリプト、スクリプトのグループ、またはスイート全体を実行するための追加オプションを提供します。

![スクリプトランナー](/img/script_runner/script_runner.png)

## スクリプトランナーのメニュー

### ファイルメニュー項目

<!-- Image sized to match up with bullets -->

<img src={require('@site/static/img/script_runner/file_menu.png').default}
alt="ファイルメニュー"
style={{"float": 'left', "margin-right": 50 + 'px', "height": 250 + 'px'}} />

- エディタとファイル名をクリア
- RubyまたはPythonで新しいテストスイートを作成
- 開くファイルを選択するダイアログを開く
- 最近使用したファイルを開く
- 現在開いているファイルをディスクに保存
- 現在のファイルの名前を変更
- 現在のファイルをブラウザにダウンロード
- 現在のファイルを削除（永久に！）
  <br/>
  <br/>

#### ファイルを開く

ファイルを開くダイアログには、インストールされたターゲットのツリービューが表示されます。フォルダを手動で開いて、必要なファイルを参照できます。また、上部の検索ボックスを使用し、ファイル名の一部を入力して結果をフィルタリングすることもできます。

![ファイルを開く](/img/script_runner/file_open.png)

#### 名前を付けて保存

ファイルを初めて保存する場合、または名前を付けて保存を使用する場合、ファイル名を付けて保存ダイアログが表示されます。これはファイルを開くダイアログと同様に、インストールされたターゲットのツリービューを表示します。フォルダ名をクリックしてフォルダを選択し、ファイル名フィールドにファイル名を入力してから、OKをクリックする必要があります。既存のファイルを上書きする前に確認メッセージが表示されます。

### スクリプトメニュー項目

<!-- Image sized to match up with bullets -->

<img src={require('@site/static/img/script_runner/script_menu.png').default}
alt="スクリプトメニュー"
style={{"float": 'left', "margin-right": 50 + 'px', "height": 330 + 'px'}} />

- 開始および終了したスクリプトを表示
- 環境変数を表示
- メタデータを表示
- オーバーライドされたテレメトリ値を表示
- 構文チェックを実行
- スクリプトニーモニックチェックを実行
- 計測されたスクリプトを表示
- スクリプトコールスタックを表示
- [デバッグ](script-runner.md#debugging-scripts)プロンプトを表示
- 実際のインターフェースから切断
- すべてのスクリプトブレークポイントを削除

実行ステータスポップアップには、現在実行中のスクリプトが一覧表示されます。これにより、他のユーザーは実行中のスクリプトに接続し、現在実行中のスクリプトに沿って追跡できます。また、以前に実行されたスクリプトも一覧表示されるため、スクリプトログをダウンロードできます。

![実行中のスクリプト](/img/script_runner/running_scripts.png)

## スクリプトの実行

通常のスクリプトを実行するには、単にスクリプトを開いて開始ボタン(Start)をクリックするだけです。デフォルトでは、スクリプトを開くとファイル名が更新され、エディタにスクリプトがロードされます。

![checks.rb](/img/script_runner/checks_rb.png)

開始をクリックすると、スクリプトはサーバーで起動され、スクリプトの状態は「接続中 (Connecting)」になります。

![接続中](/img/script_runner/connecting.png)

その時点で、現在実行中の行は緑色でマークされます。エラーが発生すると、行は赤色に変わり、一時停止ボタン (Pause)は「再試行 (Retry)」に変わり、行を再試行できるようになります。

![エラー](/img/script_runner/script_error.png)

これにより、テレメトリの変更に依存するチェックは、テレメトリが背景でリアルタイムに更新されているため、潜在的に再試行できます。また、「進む (Go)」をクリックしてエラーを通過するか、「停止 (Stop)」をクリックしてスクリプトの実行を終了することもできます。

### スクリプトの右クリック

スクリプトを右クリックすると、いくつかのオプションが表示されます：

![右クリック](/img/script_runner/right_click.png)

「選択部分を実行 (Execute selection)」は、選択したコード部分を新しいスクリプトランナータブにコピーし、現在のスクリプトとは独立して実行します。これはコードの選択部分を実行するのに便利ですが、選択されていない他の変数への参照には注意してください。COSMOSは未定義の変数を参照できません！

「ここから実行 (Run from here)」は、カーソルの現在位置からすべてを新しいスクリプトランナータブにコピーし、現在のスクリプトとは独立して実行します。これは前半のコードの実行を避けるのに便利ですが、選択されていない他の変数への参照には注意してください。COSMOSは未定義の変数を参照できません！

「すべてのブレークポイントをクリア (Clear local breakpoints)」では、エディタの行番号をクリックして設定したブレークポイントをすばやくクリアできます。

## スクリプトスイートの実行 {#running-script-suites}

スクリプトがスイートとして構成されている場合、スクリプトランナーは自動的にファイルを解析して、スイート、グループ、およびスクリプトのドロップダウンメニューを入力します。

![スイートスクリプト](/img/script_runner/script_suite.png)

新しいスイートを生成するには、ファイル (File) -> 新規スイート (New Suite) を使用し、RubyまたはPythonを選択してその言語でスイートを作成します。

### グループ

グループクラスには、テストまたは操作を実行するために使用されるメソッドが含まれています。グループクラス内で実装される「script」、「op」、または「test」で始まるメソッドは、実行するスクリプトとして自動的に含まれます。例えば、上の画像では、「script_power_on」がスクリプトドロップダウンメニューにあることに気づくでしょう。別の簡単なRubyの例：

<!-- prettier-ignore -->
```ruby
require 'openc3/script/suite.rb'
class ExampleGroup < OpenC3::Group
  def setup
    puts "setup"
  end
  def script_1
    puts "script 1"
  end
  def teardown
    puts "teardown"
  end
end
```

同等のPythonの例：

<!-- prettier-ignore -->
```python
from openc3.script.suite import Suite, Group
class ExampleGroup(Group):
    def setup(self):
        print("setup")
    def script_1(self):
        print("script 1")
    def teardown(self):
        print("teardown")
```

setupとteardownメソッドは特別なメソッドで、グループドロップダウンメニューの横にあるセットアップとティアダウンボタンを有効にします。これらのボタンをクリックすると、関連するメソッドが実行されます。

### スイート

グループはSuiteから継承するクラスを作成し、add_groupメソッドを呼び出すことでスイートに追加されます。例えばRubyでは：

<!-- prettier-ignore -->
```ruby
class MySuite < OpenC3::Suite
  def initialize
    add_group('ExampleGroup')
  end
  def setup
    puts "Suite setup"
  end
  def teardown
    puts "Suite teardown"
  end
end
```

Pythonでは：

<!-- prettier-ignore -->
```python
from openc3.script.suite import Suite, Group
class MySuite(Suite):
    def __init__(self):
        self.add_group(ExampleGroup)
    def setup(self):
        print("Suite setup")
    def teardown(self):
        print("Suite teardown")
```

ここでも、スイートドロップダウンメニューの横にあるセットアップとティアダウンボタンを有効にするsetupとteardownメソッドがあります。

同じファイル内に複数のスイートとグループを作成でき、それらは解析されてドロップダウンメニューに追加されます。スイートレベルで開始をクリックすると、すべてのグループと各グループ内のすべてのスクリプトを実行します。同様に、グループレベルで開始をクリックすると、グループ内のすべてのスクリプトを実行します。スクリプトの横にある開始をクリックすると、単一のスクリプトのみを実行します。

### スクリプトスイートオプション

スクリプトスイートを開くと、実行中のスクリプトにオプションを提供する6つのチェックボックスが作成されます。

![スイートチェックボックス](/img/script_runner/suite_checkboxes.png)

#### エラーで一時停止

エラーが発生した場合にスクリプトを一時停止します。これはデフォルトで、通常のスクリプトの実行方法と同じです。このボックスのチェックを外すと、ユーザーの介入なしにエラーを通過してスクリプトを続行することができます。エラーに遭遇した際にユーザーが「進む」をクリックするのと似ています。

#### エラー後も続行

エラーが発生した場合もスクリプトを続行します。これはデフォルトで、通常のスクリプトの実行方法と同じです。このボックスのチェックを外すと、最初に発生したエラーの後にスクリプトが終了し、スイート/グループ内の他のスクリプトが実行されます。

#### エラー後に中止

エラーに遭遇すると実行全体を中止します。スイートのグループの最初のスクリプトでエラーが発生すると、スイート全体の実行が停止します。注：エラー後も続行が設定されている場合、現在のスクリプトは続行して完了することが許可されます。

#### マニュアル

Rubyでは、`$manual`というグローバル変数をtrueに設定します。Pythonでは、`RunningScript.manual`をTrueに設定します。このボックスを設定すると、スクリプトの作者はオペレータが手動ステップを実行するかどうかを判断できます。スクリプト内でこの変数を使用するかどうかはスクリプト作者次第です。

#### ループ

ユーザーが開始したものを継続的にループします。ユーザーがグループの横にある開始をクリックすると、グループ全体がループされます。これは、時々だけ発生するトリッキーなタイミングエラーをキャッチしてデバッグするのに便利です。

#### エラーでループを中断

エラーが発生した場合にループを中断します。ループオプションが設定されている場合にのみ使用可能です。

## スクリプトのデバッグ {#debugging-scripts}

デバッグプロンプトを有効にすると、スクリプトとログメッセージの間に追加の行が表示されます。ローカル変数を入力すると、ログメッセージに出力されます。また、`var = 10`と入力してローカル変数を設定することもできます。

![デバッグ](/img/script_runner/debug.png)

ステップボタンを使用すると、スクリプトを1行ずつ進めることができます。「進む」をクリックすると通常の実行が続行されます。