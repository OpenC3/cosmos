---
title: ログ構造
description: COSMOS ログファイルの構造
sidebar_custom_props:
  myEmoji: 🪵
---

更新：2025年4月16日 OpenC3 COSMOS 6.3.0のフォーマットに対応

## パケットログファイルフォーマット

OpenC3 COSMOS 6のパケットログは、さまざまなターゲットから受信した生のバイナリパケットを保存するために使用されます。また、JSON構造で保存された復調されたパケットも保存されます。

### ファイルヘッダー

COSMOS 6のパケットログファイルは、8文字のシーケンス「COSMOS6\_」で始まります。これはファイル名に依存せずにファイルの種類を識別し、新旧のバージョンと区別するために使用できます。

### エントリータイプ

パケットログファイルには6つの異なるエントリータイプがあり、将来の拡張のための余地があります。すべてのエントリーヘッダーはビッグエンディアンのバイナリデータです。

#### 共通エントリーフォーマット

この共通フォーマットはすべてのパケットログエントリーに使用されます：

| フィールド        | データ型               | 説明                                                                                                                                          |
| ------------------ | ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| Length（長さ）       | 32-bit符号なし整数 | 長さフィールドを含まないエントリーの総バイト長。したがって最大エントリーサイズは4GiBとなります。                                                 |
| Entry Type（エントリータイプ）   | 4-bit符号なし整数  | エントリータイプ：<br/>1 = ターゲット宣言<br/>2 = パケット宣言<br/>3 = 生パケット<br/>4 = JSON/CBORパケット<br/>5 = オフセットマーカー<br/>6 = キーマップ |
| Cmd/Tlm Flag（コマンド/テレメトリフラグ） | 1-bit符号なし整数  | 1 = コマンド<br/>0 = テレメトリ                                                                                                                        |
| Stored Flag（保存フラグ）  | 1-bit符号なし整数  | 1 = 保存データ<br/>0 = リアルタイムデータ                                                                                                                |
| Id Flag（IDフラグ）      | 1-bit符号なし整数  | 1 = ID存在<br/>0 = ID非存在                                                                                                                |
| CBOR Flag（CBORフラグ）     | 1-bit符号なし整数  | 「JSON/CBORパケット」でのみ有効<br/>1 = CBORデータ<br/>0 = JSONデータ                                                                               |
| Extra Flag（追加フラグ）    | 1-bit符号なし整数  | 1 = 追加データ存在<br/>0 = 追加データ非存在（COSMOS 5.11で追加）                                                                                      |
| Received Time Flag（受信時間フラグ） | 1-bit符号なし整数  | 1 = 受信時間あり<br/>0 = 受信時間なし（COSMOS 5.11.0で追加）                                                                             |
| Reserved（予約）      | 6-bit符号なし整数  | 将来の拡張のために予約。使用しない場合は0に設定する必要があります。                                                                                         |
| Entry Data（エントリーデータ）    | 可変長                | エントリータイプに基づく固有データ。以下のエントリータイプを参照                                                                                               |
| Id（ID）（オプション） | 32バイトバイナリハッシュ     | IDフィールドが設定されている場合、これはターゲット構成またはパケット構成を一意に識別する256ビットのSHA-256ハッシュです                    |

#### ターゲット宣言エントリー

ログファイルの書き込み時に初めて見られるターゲットの名前を宣言します。

| フィールド     | データ型                    | 説明 |
| ----------- | ---------------------------- | ----------- |
| Target Name（ターゲット名） | 可変長ASCII文字列 | ターゲット名 |

#### パケット宣言エントリー

ログファイルの書き込み時に初めて見られるパケットの名前を宣言します。インデックスによって関連するターゲット名を参照します。

| フィールド      | データ型                    | 説明                                                                                                                                                                                                        |
| ------------ | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Target Index（ターゲットインデックス） | 16-bit符号なし整数      | ファイル内のターゲット宣言の順序から生成された、動的に構築されたターゲット名テーブルへのインデックス。最初のターゲット宣言はインデックス0、2番目のターゲット宣言はインデックス1を取得します。 |
| Packet Name（パケット名） | 可変長ASCII文字列 | パケット名                                                                                                                                                                                                        |

#### 生パケットとJSONパケットのエントリー

パケットのメインデータを保持します。生パケットはCOSMOS復調フェーズ前のデータです。「JSON」パケットは復調後のデータです。「JSON」パケットは現在、ストレージサイズを削減するために通常JSONではなくCBORとして保存されることに注意してください。

| フィールド                       | データ型                  | 説明                                                                                                                                                                                                                                                                                                                                                                    |
| ----------------------------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Packet Index（パケットインデックス）           | 16-bit符号なし整数    | ファイル内のパケット宣言の順序から生成された、cmd_or_tlm/ターゲット名/パケット名タプルの動的に構築されたテーブルへのインデックス。最初のパケット宣言はインデックス0、2番目のパケット宣言はインデックス1を取得します。これにより、1つのファイル内の一意のパケットタイプの最大数は65536に制限されます。                                                   |
| Packet Timestamp（パケットタイムスタンプ）        | 64-bit符号なし整数    | Unixエポック（1970年1月1日午前0時）からのナノ秒単位のパケットタイムスタンプ。このフィールドには、生およびJSONパケットエントリー（復調されたデータを保存するために使用）の両方の「パケット時間」が含まれます。JSONパケットエントリーの場合、必要に応じてJSONデータからパケット受信時間を抽出することもできます。                                                                   |
| Received Timestamp（受信タイムスタンプ）（オプション） | 64-bit符号なし整数    | 受信時間フラグが設定されている場合にのみ存在します（現在は生ログファイルのみ）。Unixエポック（1970年1月1日午前0時）からのナノ秒単位の受信タイムスタンプ。このフィールドには、生パケットエントリー（復調されたデータを保存するために使用）の「受信時間」が含まれます。JSONパケットエントリーの場合、必要に応じてJSONデータからパケット受信時間を抽出できます。 |
| Extra Length（追加データ長）（オプション）     | 32-bit符号なし整数    | 追加フラグが設定されている場合にのみ存在。自身を含まない追加データのバイト単位の長さ。                                                                                                                                                                                                                                                                                         |
| Extra Data（追加データ）（オプション）       | 可変長ブロックデータ | 追加フラグが設定されている場合にのみ存在。CBORまたはJSONでエンコードされた追加データのオブジェクト。                                                                                                                                                                                                                                                                                                  |
| Packet Data（パケットデータ）             | 可変長ブロックデータ | 生パケットエントリーの生バイナリパケットデータ、およびJSONパケットエントリーのASCII JSONデータ（またはフラグが設定されている場合はCBOR）。共通エントリーフォーマットのIdフィールドはいずれのタイプのパケットエントリーでもサポートされていないことに注意してください。                                                                                                                                                                 |

#### オフセットマーカーエントリー

このファイルに保存された最後のパケットのRedisストリームオフセットが含まれています。このエントリーにより、ログファイルからCOSMOSが受信した最新のデータを保持するRedisストリームへのシームレスな移行が可能になります。

| フィールド       | データ型                    | 説明         |
| ------------- | ---------------------------- | ------------------- |
| Offset Marker（オフセットマーカー） | 可変長ASCII文字列 | Redisオフセットマーカー |

#### キーマップエントリー

キーマップエントリーは、復調された値の名前のサイズを削減することにより、ログファイルのサイズをさらに減らすために使用されます。各値には0からカウントアップする数値名が付けられ、これにより復調されたデータのサイズが大幅に削減されます。注：将来的には、base64に似たより密度の高いエンコーディングに変更することでさらに強化される可能性があります。キーマップはパケットの最初の受信時に生成されます。将来のパケットが異なるキーを持つ場合、名前はそのまま使用され、削減は得られません。通常、パケットキーはファイル内で変更されません。

| フィールド      | データ型                    | 説明                                                                                                                                                                                                        |
| ------------ | ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Packet Index（パケットインデックス） | 16-bit符号なし整数      | ファイル内のパケット宣言の順序から生成された、パケット名の動的に構築されたテーブルへのインデックス。最初のパケット宣言はインデックス0、2番目のパケット宣言はインデックス1を取得します。 |
| Key Map（キーマップ）    | 可変長ASCII文字列 | 数値キーから実際のパケット項目名へのマッピングを持つキーマップデータ                                                                                                                                              |